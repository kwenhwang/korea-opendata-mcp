# 저수율 계산 이슈 및 향후 개선 방안

## 📋 이슈 요약

**문제**: 홍수통제소 API에서 총저수용량 정보를 제공하지 않아 정확한 저수율 계산이 불가능

**해결**: 저수율 계산 기능을 비활성화하고 향후 개선 예정

## 🔍 상세 분석

### 홍수통제소 API 제공 데이터

**dam/list.json**:
- `swl`: 수위 (Water Level) - m 단위
- `inf`: 유입량 (Inflow) - m³/s 단위  
- `sfw`: 현재저수량 (Storage) - 백만m³ 단위
- `ecpc`: 공용량 (Effective Capacity) - 백만m³ 단위
- `tototf`: 총방류량 (Total Outflow) - m³/s 단위

**dam/info.json**:
- `pfh`: 계획홍수위 (Planned Flood Level) - m 단위
- `fldlmtwl`: 제한수위 (Flood Limit Water Level) - m 단위

### 문제점

1. **총저수용량 정보 부재**: 홍수통제소 API에서 총저수용량을 직접 제공하지 않음
2. **잘못된 가정**: `pfh`(계획홍수위)를 총저수용량으로 오해했으나, 이는 수위(m) 단위
3. **부정확한 계산**: 하드코딩된 총저수용량 값으로 계산한 저수율이 실제값과 불일치

### 시도했던 해결책

1. **하드코딩된 총저수용량**: 소양댐(2900), 대청댐(1500), 충주댐(1750) 백만m³
2. **다양한 계산 공식 시도**:
   - `현재저수량 ÷ 총저수용량 × 100`
   - `현재저수량 ÷ (총저수용량 - 공용량) × 100`
3. **API 필드 재해석**: `ecpc`를 공용량으로, `sfw`를 현재저수량으로 정확히 해석

## ✅ 현재 상태

**저수율 계산 비활성화 완료**:
- 모든 댐에서 저수율 계산 기능 제거
- 현재저수량(sfw) 정보는 여전히 제공
- 수위 분석 기능은 정상 작동

## 🚀 향후 개선 방안

### 1. 총저수용량 데이터 확보
- **한국수자원공사 공식 데이터**: 각 댐별 총저수용량 정보 수집
- **외부 API 연동**: 다른 정부기관 API에서 총저수용량 정보 확인
- **정적 데이터 관리**: 총저수용량 정보를 별도 데이터베이스로 관리

### 2. 저수율 계산 공식 정확성 확보
- **공식 검증**: 수자원공사 공식 저수율 계산 방식 확인
- **단위 통일**: 모든 데이터의 단위 통일 및 변환 로직 구현
- **실시간 검증**: 계산된 저수율과 공식 발표값 비교 검증

### 3. 대안 정보 제공
- **수위 분석 강화**: 현재 수위와 제한수위 비교 분석
- **저수량 추이**: 현재저수량의 변화 추이 제공
- **홍수 위험도**: 수위 기반 홍수 위험도 분석

## 📝 기술적 변경사항

### 수정된 파일
- `src/lib/hrfco-api.ts`: 저수율 계산 로직 제거

### 제거된 기능
- `storage_rate`: 저수율 계산 및 표시
- `total_storage`: 총저수용량 표시  
- `storage_calculation_note`: 계산 방식 안내

### 유지된 기능
- `current_storage`: 현재저수량 표시
- `water_level_analysis`: 수위 분석
- `flood_limit_level`: 제한수위 표시

## 🎯 다음 단계

1. **총저수용량 데이터 수집**: 한국수자원공사 등에서 공식 데이터 확보
2. **API 확장**: 총저수용량 정보를 제공하는 새로운 API 엔드포인트 개발
3. **저수율 계산 재구현**: 정확한 데이터 기반으로 저수율 계산 기능 복원

---

**작성일**: 2025-01-03  
**상태**: 저수율 계산 비활성화 완료  
**다음 리뷰**: 총저수용량 데이터 확보 시